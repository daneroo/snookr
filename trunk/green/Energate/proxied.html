<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
    <head>
        <title>Energate Prototype</title>
        <!-- Copyright 2010 Daniel Lauzon <daniel.lauzon@gmail.com> -->
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=320, initial-scale=1.0, maximum-scale=2.3, user-scalable=0;"/>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.2/jquery-ui.min.js"></script>
        <script type="text/javascript" src="js/jquery.json-2.2.js"></script>
        <script type="text/javascript" src="js/jquery.timer-0.1.js"></script>
        <script type="text/javascript" src="js/energate.js"></script>

        <script type="text/javascript">

            $(function(){
                debug("Proxied connect!");

                if (0){

                    var username='insertusername';
                    var passwd='insertpassword';

                    function doOne(name,cookie){
                        var data = getit(cookie,username);
                        debug(""+name+": "+$.toJSON(data));
                        //debug(data);
                    }

                    doOne("stale", "firstenergystaging_sessionid=36a1ad6d8ff833d111f1a354501c2709");
                    doOne("bad","firstenergystaging_sessionid=abcdefghijklmnopqrstuvwxyz012345");
                    doOne("null",null);
                    doOne("empty","");

                    var sessionCookie = login(username,passwd+"bad");
                    debug("bad session: "+sessionCookie);
                    var sessionCookie = login(username,passwd);
                    debug("good session: "+sessionCookie);

                    doOne("goodAndNew-1",sessionCookie);
                    doOne("goodAndNew-2",sessionCookie);
                }

                var permanentSessionCookie=null;

                var loginCB=function(){
                    var username=$('#username').val();
                    var passwd=$('#passwd').val();
                    var remember=$('#rememberPass').attr('checked');
                    debug("remember: "+remember);
                    var sessionCookie = login(username,passwd);
                    if (sessionCookie=='Login Failed'){
                        $('#status').html('Login Failed');
                    } else {
                        $('#status').html(sessionCookie.split('=')[1]);
                        $('#loginForm').fadeOut();
                        permanentSessionCookie=sessionCookie;
                        start(10000);
                    }
                    debug("interactive session: "+sessionCookie);
                    return false;
                };
                $('#loginForm').submit(loginCB);

                function round(x){
                    return Math.round(x*10)/10;
                }
                function showTstat(tstat_status){
                    tstat_status = tstat_status || {
                        "high_setpoint":60.9980010986,
                        "inside_temp":74.4980010986,
                        "valid":true,
                        "connected":true,
                        "low_setpoint":0
                    };
                    $('#tstat').show();
                    $('#inside_temp').text(round(tstat_status.inside_temp));
                    $('#high_setpoint').text(round(tstat_status.high_setpoint));
                    $('#low_setpoint').text(round(tstat_status.low_setpoint));
                    $('#status').html(""+new Date()+"<br />"+permanentSessionCookie.split('=')[1]);

                }
                function oneIteration(){
                    debug("iter: "+permanentSessionCookie);
                    var username=$('#username').val();
                    $('#busySpinner').show();
                    var data = getit(permanentSessionCookie,username);
                    $('#busySpinner').hide();
                    var tstat = data[0].result[0].tstat_status;
                    debug("itertstat:");
                    debug(tstat);
                    showTstat(tstat);

                }
                function start(interval){
                    interval = interval || 5000;
                    var thing = this;
                    var cb = function(timer){
                        oneIteration();
                    }
                    $.timer(interval,cb);
                    oneIteration();
                }


                $("#mode").buttonset();
                $("#fan").buttonset();
                $("#hold").buttonset();

            });
        </script>
        <style type="text/css" media="screen">
            @import "http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.2/themes/smoothness/jquery-ui.css";

            body {
                font-family: 'trebuchet ms', verdana, arial;
                background: rgb(255, 255, 255); /* The Fallback */
                background: rgba(255, 255, 255, 1.0);
            }
            #logo {
                padding-top: 1em;
                padding-bottom: 1em;
            }
            #tstat {
                display: none; /* until we have data...*/
            }
            #busyBox {
                margin-top: 2em;
                height: 20px;
            }
            #busySpinner {
                display: none; /* until we are processing...*/
            }
            #status {
                margin-top: 1em;
                color: gray;
                font-size: 80%;
                text-align: center;
            }

            .controls {
                margin-top: 1em;
            }

            .section {
                display: inline-block;
                width:4em;
                text-align: right;
            }
            .radioset {
                padding-top: 4px;
                font-size: 70%;
            }
        </style>
    </head>
    <body>
        <!--
        This test shows a proxied connection client: see <b>Same origin policy</b>.
        -->

        <div id="logo">
            <center><img src="images/logo.gif" /></center>
        </div>
        <form id="loginForm" action="#">

            <label for="username">Username:</label>
            <input type="text" id="username" /><br />

            <label for="password">Password:</label>
            <input type="password" id="passwd" /><br />

            <label for="password">Remember?</label>
            <input type="checkbox" id="rememberPass" />
            <input type="submit" value="Go!"/>
        </form>
        <div id="tstat">
            <center>
                Inside Temp: <span id="inside_temp">--</span> &deg;F
            </center>
            <center>
                Cooling Setpoint: <span id="low_setpoint">--</span> &deg;F
            </center>
            <center>
                Heating Setpoint: <span id="high_setpoint">--</span> &deg;F
            </center>
            <div class="controls">
                <div id="mode" class="radioset">
                    <div class="section">Mode:</div>
                    <input type="radio" id="mode-auto" name="mode" /><label for="mode-auto">Auto</label>
                    <input type="radio" id="mode-heat" name="mode" checked="checked" /><label for="mode-heat">Heat</label>
                    <input type="radio" id="mode-cool" name="mode" /><label for="mode-cool">Cool</label>
                    <input type="radio" id="mode-off" name="mode" /><label for="mode-off">Off</label>
                </div>
                <div id="fan" class="radioset">
                    <div class="section">Fan:</div>
                    <input type="radio" id="fan-auto" name="fan" checked="checked" /><label for="fan-auto">Auto</label>
                    <input type="radio" id="fan-on" name="fan" /><label for="fan-on">On</label>
                </div>
                <div id="hold" class="radioset">
                    <div class="section">Hold:</div>
                    <input type="radio" id="hold-off" name="hold" checked="checked" /><label for="hold-off">Off</label>
                    <input type="radio" id="hold-on" name="hold" /><label for="hold-on">On</label>
                </div>
            </div>
        </div>
        <div id="busyBox">
            <center><img id="busySpinner" src="images/busy20trans.gif" /></center>
        </div>
        <div id="status"></div>

        <div style="display: none">
            <div>Login to <a target="_new" href="https://firstenergy-staging.getgreenbox.com/accounts/login/">https://firstenergy-staging.getgreenbox.com/accounts/login/</a></div>
            <div>to access <a target="_new" href="http://firstenergy-staging.getgreenbox.com/">http://firstenergy-staging.getgreenbox.com/</a></div>
        </div>
    </body>
</html>
