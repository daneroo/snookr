<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">
<head profile="http://gmpg.org/xfn/11">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>AJAX Image Upload</title>
    <script type="text/javascript" src="js/jquery-1.3.2.js" ></script>
    <script type="text/javascript" src="js/ajaxupload.js" ></script>
    <!-- Required for jQuery dialog demo-->
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/jquery-ui.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="ekolib-imgpicker-1.0.0.js" ></script>
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/themes/start/jquery-ui.css" type="text/css" media="all" />

    <link rel="stylesheet" type="text/css" href="./styles.css" />
    <script type="text/javascript" >
        //var baseURL = '';
        var baseURL = 'http://axial.imetrical.com/EkoImgUpload/';

        function debug(message){
            if (window.console && window.console.firebug){
                console.log(message);
            }
        }
        function basename(path) {
            return path.replace(/\\/g,'/').replace( /.*\//, '' );
        }

        $(function(){
            var ekoIP = new EkoImagePicker();
            ekoIP.render('#dialogHolder');
            $('#selectedFile').click(function(){
                getList();
                ekoIP.dialogElt.dialog("open");
                ekoIP.status('Coucou '+new Date());
                return false;
            });

            function clear(){
                ekoIP.fileimglistElt.html('');
            }
            function seed(data){
                var images = data.images;
                for (var i=0;i<images.length;i++){
                    addIMG(images[i]);
                }
            }
            function addIMG(file){
                var imgurl = baseURL+file;
                $('<li></li>').appendTo(ekoIP.fileimglistElt)
                .html('<img src="'+imgurl+'" alt="'+basename(file)+'" /><br />')
                .addClass('success')
                .click(function(){
                    $('#selectedFile').text(file);
                    $('#selectedImage').attr('src', imgurl);
                    ekoIP.dialogElt.dialog("close");
                });
            }
            function addERR(file){
                $('<li></li>').appendTo(ekoIP.fileimglistElt).text(file).addClass('error');
            }
            function getList(aURL){
                //aURL = aURL || 'imglist.php';
                aURL = aURL || baseURL+'imglist.php';
                aURL+='?'+new Date().getTime();
                debug('getting: '+aURL);
                $.ajax({
                    url: aURL, // url from name ??
                    //data: data,
                    dataType: 'jsonp', // html,xml,json,jsonp
                    jsonp:'jsonp',
                    async: true,
                    success: function(data) {
                        debug('success');
                        debug(data);
                        clear();
                        seed(data);
                    }
                });

            }
            getList();


        });/*]]>*/</script>
</head>

<body>
    <!-- Example 4 -->
    <p>Eko Image Picker, with integrated Uploader</p>
    <p>Selected Image <span id="selectedFile" >No Image Selected (click to select)</span>
        <br />
        <img id="selectedImage" />
    </p>

    <div id="dialog" style="display:none;" title="Choose an Image">
        <div class="ui-state-highlight ui-corner-all" style="padding: 0 .7em;" id="status" ><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span><span>Status goes here</span></div>
        <div id="uploadBtn" ><span>Upload Image</span></div>
        <div id="listwrapper">
            <ul id="files" ></ul>
        </div>
    </div>


    <div id="dialogHolder"></div>

</body>