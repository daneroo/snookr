<!doctype html>
<html manifest="mirawatt-iphone.manifest">
    <head>
        <meta charset="UTF-8" />

        <title>Mirawatt &kappa;</title>

        <style type="text/css" media="screen">@import "jqtouch/jqtouch.min.css";</style>
        <style type="text/css" media="screen">@import "themes/jqt/theme.min.css";</style>
        <script type="text/javascript" src="http://www.google.com/jsapi"></script>
        <script src="jqtouch/jquery.1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="jqtouch/jqtouch.min.js" type="application/x-javascript" charset="utf-8"></script>
        <script type="text/javascript" src="jquery.timer.js"></script>
        <script type="text/javascript" src="imetrical-1.0.js"></script>
        <script type="text/javascript" charset="utf-8">
            // new google viz stuff
            vizLoaded = false;
            google.setOnLoadCallback(function(){vizLoaded=true});
            // delay this loading...
            google.load("visualization", "1", {packages:["columnchart","areachart"]});
            function loadGooglevizSoon(){
                google.load("visualization", "1", {packages:["columnchart","areachart"]});
            }
            //setTimeout("loadGooglevizSoon()",20000);
            var startLoad=new Date()
            function drawAChart(whichOne) {
                feed = feedsRef[whichOne%feedsRef.length];
                var elapsed = new Date().getTime()-startLoad.getTime();
                if (vizLoaded && elapsed>25000){
                    drawChart(feed);
                } else {
                    //chartURL="http://chart.apis.google.com/chart?chxt=x,y&chds=0,300&chd=t:61,42,58,107,81,75,150,222,190,216,102,56,56,65,71,71,114,69,65,147,74,71,55,135&chco=55ff00,33aa00&chbh=a&chs=320x180&cht=bvs&chtt=Power%20Connsumption%20last%2024%20hours%20(kW)&chxl=0:|12||||||18||||||00||||||06||||||1:|0|3";
                    // solid fill black with alpha=0: &chf=bg,s,00000000
                    // title color: chts=FFFFFF  (optional: ,fontSize)
                    // axis 0,1 colors: chxs=0,000000,,,000000|1,000000,,,000000
                    var chartURL="http://chart.apis.google.com/chart?chxt=x,y&chxs=0,ffffff,12,0,lt,ffffff|1,ffffff,12,1,lt,ffffff&chds=0,300&chd=t:61,42,58,107,81,75,150,222,190,216,102,56,56,65,71,71,114,69,65,147,74,71,55,135&chf=bg,s,00000000&chco=55ff00,33aa00&chbh=a&chs=320x180&cht=bvs&chts=FFFFFF&chtt=Power%20Connsumption%20last%2024%20hours%20(kW)&chxl=0:|12||||||18||||||00||||||06||||||1:|0|3";
                    if (whichOne%3==1){
                        chartURL="daily.png";
                    } else if (whichOne%3==2){
                        chartURL="yearly.png";
                    }
                    var chartImgHtml='<img id="chartImg" src="'+chartURL+'">';
                    $("#chart").html(chartImgHtml);
                }
            }

            // getting ready to inject from settings..
            var prefs = null;
            try { prefs = new _IG_Prefs(__MODULE_ID__); } catch(err) {}
            var getRefreshIntervalMS = function() {
                var refreshInterval = 15;
                if (prefs) refreshInterval = prefs.getString("refreshInterval");
                if (refreshInterval<2) refreshInterval=2;
                return refreshInterval*1000; // every n seconds
            };


            var feedsRef; // keep a reference to the feeds array
            var currentFeed=0;
            function myInjector(feeds) {
                flashInjector();
                feedsRef = feeds;
                standardInjector(feeds);
                if (true||vizLoaded) {
                    drawAChart(currentFeed);
                    if (animCanRun) {
                        currentFeed= (currentFeed+1)%5;
                    }
                }
            }

            $.jQTouch({
                icon: 'mirawattIPhoneIcon-57x57.png',
                addGlossToIcon: true,
                startupScreen: 'mirawattIPhoneStartup-320-460.png',
                statusBar: 'black',
                preloadImages: [
                    'themes/jqt/img/chevron_white.png',
                    'themes/jqt/img/bg_row_select.gif',
                    'themes/jqt/img/back_button.png',
                    'themes/jqt/img/back_button_clicked.png',
                    'themes/jqt/img/button_clicked.png',
                    'themes/jqt/img/grayButton.png',
                    'themes/jqt/img/whiteButton.png',
                    'themes/jqt/img/loading.gif'
                ]
            });

            // Some sample Javascript functions:
            $(function(){

                // Show a swipe event on swipe test
                $('#swipeme').addTouchHandlers().bind('swipe', function(evt, data){
                    $(this).html('You swiped <strong>' + data.direction + '</strong>!');
                    // alert('Swiped '+ data.direction +' on #' + $(evt.currentTarget).attr('id') + '.');
                });

                $('a[target="_blank"]').click(function(){
                    if(confirm('This link opens in a new window.'))
                    {
                        return true;
                    }
                    else
                    {
                        $(this).removeClass('active');
                        return false;
                    }
                });

                // Page transition callback events
                $('#pageevents').
                    bind('pageTransitionStart', function(e, info){
                    $(this).find('.info').append('Started transitioning ' + info.direction + '&hellip; ');
                }).
                    bind('pageTransitionEnd', function(e, info){
                    $(this).find('.info').append(' finished transitioning ' + info.direction + '.<br /><br />');
                });


                // AJAX with callback event
                $('#callback').
                    bind('pageTransitionEnd', function(e, info){
                    if (info.direction == 'in' && $(this).data('loaded') != 'true')
                    {
                        $(this).
                            append($('<div>Loading&hellip;</div>').
                            load('ajax.html .info', function(){
                            $(this).parent().data('loaded', 'true');
                        }));
                    }
                });

                // Orientation callback event
                $('body').bind('turn', function(e, data){
                    $('#orient').html('Orientation: ' + data.orientation);
                })

                // here be imetrical stuff:
                iM18nLang='en';
                // fetching timer
                startAnimNow(getRefreshIntervalMS(), function (timer) {
                    // http://imetrical.appspot.com/feeds?owner=daniel
                    //fetchAndMapFeeds(null,myInjector);
                    //fetchAndMapFeeds("staticfeed.xml",myInjector);
                    fetchAndMapFeeds("/feeds?owner=daniel",myInjector);
                });

            });
        </script>
        <style type="text/css" media="screen">
            body.fullscreen #home .info {
                display: none;
            }
            #about {
                padding: 50px 10px 40px;
                text-shadow: rgba(255, 255, 255, 0.3) 0px -1px 0;
                font-size: 13px;
                text-align: center;
                background: #161618;
            }
            #about p {
                margin-bottom: 8px;
            }
            #about a {
                color: #fff;
                font-weight: bold;
                text-decoration: none;
            }
            /* grid alignment.. */
            .im-feed-units {
                /*margin-left: 33px;*/
                color: #999999;
                /*width:20px;*/

            }
            .im-v-w, .im-v-kw, .im-v-kwhd {
                color: #55ff00;
            }
            #status {
                color:gray;
                text-align:center;
            }
            #error {
                display:none;
                color:red;
            }
            .im-flash {
                color:red;
            }
            /* override ul li style */
            ul li { /* p: t r b l */
                padding: 2px 10px 2px 10px;
            }
            #chartAnchor {
                /*background-color: black;*/
                height: 180px;
            }
            #chart {
                /*background-color: blue;*/
                height: 180px;
                position: relative; top: 0px; left: 0px;
                z-index:10;
            }
        </style>
    </head>
    <body>
        <div id="home">
            <div class="toolbar">
                <a class="button leftButton flip" id="infoButton" href="#about">About</a>
                <h1>Mirawatt &kappa;</h1>
                <a class="button slideup" id="infoButton" href="#about">Settings</a>
            </div>
            <div>
                <div id="error" >ERR</div>
                <div id="chartAnchor">
                    <div id="chart"><!--<img id="chartImg" src="daily.png">--></div>
                </div>
            </div>
            <ul>
                <li class="im-feed-Live" onclick="drawAChart(0)"><a href="#"><span class="im-feed-name">Live</span></a><small class="counter"><span class="im-v-w">0000</span> <span class="im-feed-units">W</span></small></li>
                <li class="im-feed-Hour" onclick="drawAChart(1)"><a href="#"><span class="im-feed-name">Hour</span></a><small class="counter"><span class="im-v-kw">0.00</span> <span class="im-feed-units">kW</span></small></li>
                <li class="im-feed-Day" onclick="drawAChart(2)"><a href="#"><span class="im-feed-name">Day</span></a><small class="counter"><span class="im-v-kwhd">00.0</span> <span class="im-feed-units">kWh/d</span></small></li>
                <li class="im-feed-Week" onclick="drawAChart(3)"><a href="#"><span class="im-feed-name">Week</span></a><small class="counter"><span class="im-v-kwhd">00.0</span> <span class="im-feed-units">kWh/d</span></small></li>
                <li class="im-feed-Month" onclick="drawAChart(4)"><a href="#"><span class="im-feed-name">Month</span></a><small class="counter"><span class="im-v-kwhd">00.0</span> <span class="im-feed-units">kWh/d</span></small></li>
                <li class="im-feed-Year" onclick="drawAChart(5)"><a href="#"><span class="im-feed-name">Year</span></a><small class="counter"><span class="im-v-kwhd">00.0</span> <span class="im-feed-units">kWh/d</span></small></li>
            </ul>
            <div id="status"></div>
            <!--
            <ul class="individual">
                <li><a>Settings</a></li>
                <li>Info</li>
            </ul>
            -->
            <div class="info">
                <p>Add this page to your home screen to view the custom icon, startup screen, and full screen mode.</p>
            </div>
        </div>

        <div id="callbacks">
            <div class="toolbar">
                <h1>Events</h1>
                <a class="back" href="#home">Home</a>
            </div>
            <ul>
                <li><a href="#pageevents">Page events</a></li>
                <li id="swipeme">Swipe me!</li>
                <li id="orient">Orientation: <strong>profile</strong></li>
            </ul>
        </div>

        <div id="demos">
            <div class="toolbar">
                <h1>Demos</h1>
                <a class="back" href="#home">Home</a>
            </div>
            <div class="info">
                These apps open in a new window. Don&#8217;t forget to save them to your home screen to enable full-screen mode.
            </div>
            <ul>
                <li class="forward"><a target="_blank" href="../todo/">To do app</a></li>
                <li class="forward"><a target="_blank" href="../clock/">Clock app</a></li>
            </ul>

        </div>

        <div id="pageevents">
            <div class="toolbar">
                <h1>Page Events</h1>
                <a class="back" href="#home">Events</a>
            </div>
            <div class="info" style="font-weight: normal;">

            </div>
        </div>

        <div id="about">
            <p><img src="mirawattIPhoneAbout-200x200.png" /></p>
            <p>Save Energy Now</p>
            <p><em>IPhone Web Version 1.0 &beta;</em></p>

            <p><br /><br /><a href="#" class="grayButton goback">Close</a></p>
        </div>

        <div id="ajax">
            <div class="toolbar">
                <h1>AJAX</h1>
                <a class="back" href="#home">Home</a>
            </div>
            <ul>
                <li class="arrow"><a href="#ajax_post">POST Form Example</a></li>
                <li class="arrow"><a href="ajax.html">GET Example</a></li>
                <li class="arrow"><a href="#callback">With Callback</a></li>
            </ul>
        </div>

        <div id="flipdemo">
            <div style="font-size: 1.5em; text-align: center; margin: 160px 0 160px; font-family: Marker felt;">
                Pretty smooth, eh?
            </div>
            <a style="margin:0 10px;color:rgba(0,0,0,.9)" href="#" class="whiteButton goback">Go back</a>
        </div>

        <form id="ajax_post" action="ajax_post.php" method="POST" class="form">
            <div class="toolbar">
                <h1>Post Demo</h1>
                <a class="back" href="#">Ajax</a>
            </div>
            <ul>
                <li>
                    <input type="text" name="zip" value="" placeholder="Zip Code" />
                </li>
            </ul>
            <a style="margin:0 10px;color:rgba(0,0,0,.9)" href="#" class="submit whiteButton">Submit</a>
        </form>

        <div id="callback">
            <div class="toolbar">
                <h1>AJAX w/Callback</h1>
                <a class="back" href="#">Ajax</a>
            </div>
        </div>

        <div id="ui">
            <div class="toolbar">
                <h1>UI Demos</h1>
                <a class="back" href="#">Home</a>
            </div>

            <h2>Animation</h2>
            <ul>
                <li><a class="flip" href="#flipdemo">Page Flip</a></li>
            </ul>
            <h2>Lists</h2>
            <ul>
                <li class="arrow"><a href="#edge">Edge to Edge</a></li>
                <li class="arrow"><a href="#plastic">Plastic</a></li>
                <li class="arrow"><a href="#metal">Metal</a></li>
            </ul>
            <h2>Forms</h2>
            <ul>
                <li class="arrow"><a href="#forms">Forms</a></li>
            </ul>

        </div>

        <div id="edge" class="edgetoedge">
            <div class="toolbar">
                <h1>Edge to Edge</h1>
                <a href="#" class="back">Back</a>
            </div>

            <h4>E</h4>

            <ul>
                <li><a href="#">Elea <em>Peliche</em></a></li>
                <li>Elizabeth <em>Nogales</em></li>
                <li><small>Es mi hermano</small> <a href="#">Emiliano <em>Martín Lafuente</em></a></li>
                <li><a href="#">Enrique <em>Dans</em></a></li>
                <li><a href="#">Ernesto <em>González Aro…</em></a></li>
            </ul>

            <h4>F</h4>

            <ul>
                <li><a href="#">Fernández <em>Cols Aleix</em></a></li>
                <li><a href="#">Fernández <em>Dominguez Alex</em></a></li>
                <li><a href="#">Flavia <em>Olmedo</em></a></li>
                <li><a href="#">Francesc <em>Esplugas</em></a></li>
                <li><a href="#">Francisco <em>Perez Garzón</em></a></li>
            </ul>

            <h4>Optional List</h4>

            <ul>
                <li><small>It's free</small> <a href="#" class="arrow">Label + minilabel</a></li>
                <li><a href="#" class="arrow">Only arrow</a></li>
                <li><small>✔</small> Only labels</li>
                <li><small>☆</small> <a href="#">Only labels</a></li>
                <li><small>★</small> <a href="#">Only labels</a></li>
            </ul>

        </div>

        <div id="plastic" class="plastic">
            <div class="toolbar">
                <h1>Plastic Lists</h1>
                <a href="#" class="back">Back</a>
            </div>
            <ul>
                <li class="arrow"><small>2,99€</small> <a href="#">Simple list</a></li>
                <li class="arrow"><small>Free</small> <a href="#">Contact list</a></li>
                <li class="arrow"><small>Open Source</small> <a href="#">Content List</a></li>
                <li class="arrow"><small>35€</small> <a href="#">Metal list</a></li>
                <li><a href="normal-metal.html">Metal list</a></li>
                <li class="arrow"><a href="normal-content.html">Content List</a></li>
                <li><a href="#">Download</a></li>
            </ul>
            <div class="info">
                <p><strong>Best enjoyed on a real iPhone</strong></p>
            </div>
        </div>

        <div id="metal" class="metal">
            <div class="toolbar">
                <h1>Metal Lists</h1>
                <a href="#" class="back">Back</a>
            </div>
            <ul>
                <li class="arrow"><a href="#"><small>AM</small> 9:40 <em>Buenos Aires</em></a></li>
                <li class="arrow"><a href="#"><small>PM</small> 19:40 <em>Singapur</em></a></li>
                <li><a href="#"><small>PM</small> 22:40 <em>Japan</em></a></li>
                <li class="arrow"><a href="#">11:40 <em>New York</em></a></li>
                <li class="arrow"><a href="#">9:40 <em>Ontario</em></a></li>
            </ul>
        </div>

        <div id="forms">
            <div class="toolbar">
                <h1>Forms</h1>
                <a href="#" class="back">Back</a>
            </div>
            <form>
                <ul class="edit">
                    <li><input type="text" name="name" placeholder="Text" id="some_name" /></li>
                    <li><input type="text" name="search" placeholder="Search" id="some_name" /></li>
                    <li><input type="text" name="phone" placeholder="Phone" id="some_name"  /></li>
                    <li><input type="text" name="zip" placeholder="Numbers" id="some_name" /></li>
                    <li><textarea>Textarea</textarea></li>
                    <li>Sample Toggle <span class="toggle"><input type="checkbox" /></span></li>
                    <li><select id="lol"><optgroup label="Swedish Cars">
                                <option value ="volvo">Volvo</option>
                                <option value ="saab">Saab</option>
                            </optgroup>
                            <optgroup label="German Cars">
                                <option value ="mercedes">Mercedes</option>
                                <option value ="audi">Audi</option>
                    </optgroup></select></li>
                    <li><input type="password" name="some_name" value="iphonedelcopon" id="some_name" /></li>
                    <li><input type="checkbox" name="some_name" value="Hello" id="some_name" title="V8 Engine Type" /></li>
                    <li><input type="checkbox" name="some_name" value="Hello" checked="checked" id="some_name" title="V12 Engine Type" /></li>
                    <li><input type="radio" name="some_name" value="Hello" id="some_name" title="Only cars" /></li>
                    <li><input type="radio" name="some_name" value="Hello" id="some_name" title="Only motorbikes" /></li>
                </ul>
            </form>
        </div>
    </body>
</html>
