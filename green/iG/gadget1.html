<html><header><title>iMetrical</title></header>
<body onload="makeNativeDOMRequest()">
<h3>Hello, iMetrical (Edited again)!</h3>
<div id="content_div"></div>
    <script type="text/javascript">
      // get prefs
      //var prefs = new gadgets.Prefs();
      // Calorie limit set by user
      //var calorieLimit = prefs.getString("mycalories");

     
      function makeNativeDOMRequest() {    
        //var url = "http://imetrical.appspot.com/feeds?owner=daniel";  
        var url = "http://dl.sologlobe.com:9999/iMetrical/feeds.php";  
        xmlhttp=new XMLHttpRequest();

        if (xmlhttp!=null)  {
          xmlhttp.onreadystatechange=onResponseNative;
          xmlhttp.open("GET",url,true);
          xmlhttp.send(null);
        } else  {
          alert("Your browser does not support XMLHTTP.");
        }
      };

      function onResponseNative() {
        if(xmlhttp.readyState!=4) return;
        if(xmlhttp.status!=200) {
          alert("Problem retrieving XML data");
            return;
         }
        var domdata = xmlhttp.responseXML.documentElement;
        responseCommon(domdata)
      };

      function makeDOMRequest() {    
        var params = {};  
        params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.DOM;  
        var url = "http://imetrical.appspot.com/feeds?owner=daniel";  
        gadgets.io.makeRequest(url, response, params);
      };

      function responseIG(obj) {
        // obj.data contains a Document DOM element corresponding to the
        // page that was requested
        var domdata = obj.data;
        responseCommon(domdata)
      };
  
      function responseCommon(domdata) { 
        // Start building HTML string that will be displayed in <div>.           
        // Set the style for the <div>.        
        var html = "<pre>"

        // Get a list of the <food> element nodes in the file
        var feedList = domdata.getElementsByTagName("feed");
 
        // Loop through all <food> nodes
        for (var i = 0; i < feedList.length ; i++) { 
          // For each <food> node, get child nodes.
          var name = feedList.item(i).getAttribute("name");
          var stamp = feedList.item(i).getAttribute("stamp");
          var value = feedList.item(i).getAttribute("value");
        
          html += "name: " + name + " stamp: "+ stamp+ " value: "+value+" <br>" 
        }
        // Close up div
        html += "</pre>";
        document.getElementById('content_div').innerHTML = html;
      };

      //gadgets.util.registerOnLoadHandler(makeDOMRequest);
    </script>

</body>
</html>
